#!/bin/bash

# Update the system
sudo apt -y update

# Install new packages
sudo apt install -y python3-pip git micro build-essential

# Remove extra packages
sudo apt -y --purge remove "^alsa-.*" alsa-utils pulseaudio snapd whoopsie apport apparmor update-manager update-notifier unattended-upgrades bluez enchant-2 wamerican wbritish speech-dispatcher brltty gnome-accessibility-themes gnome-bluetooth gnome-calculator gnome-characters gnome-disk-utility gnome-font-viewer gnome-getting-started-docs gnome-initial-setup gnome-logs gnome-online-accounts gnome-themes-extra gnome-themes-extra-data ubuntu-advantage-tools ubuntu-docs ubuntu-report xcursor-themes yaru-theme-sound yaru-theme-icon yelp apt-utils linux-image-generic-hwe-20.04 "^linux-.*5\..*" xul-ext-ubufox whiptail uuid-runtime usbmuxd usbutils usb-modeswitch usb.ids update-manager-core update-inetd tcpdump tpm-udev ufw time telnet system-config-printer-udev switcheroo-control squashfs-tools spice-vdagent strace seahorse rygel rsyslog rsync rfkill "^printer-driver.*" ppp pkg-config pinentry-curses pcmciautils pciutils packagekit os-prober openvpn ntfs-3g networkd-dispatcher netplan.io netcat-openbsd mtr-tiny mtools mousetweaks modemmanager mobile-broadband-provider-info mesa-vulkan-drivers memtest86+ lshw ltrace logrotate linux-sound-base laptop-detect krb5-locales klibc-utils irqbalance iputils-tracepath iptables hunspell-en-us install-info inputattach iio-sensor-proxy ibus hdparm gvfs-fuse gstreamer1.0-tools gstreamer1.0-pulseaudio gstreamer1.0-gl gstreamer1.0-alsa gpg gnome-power-manager gkbd-capplet ghostscript genisoimage gdb gamemode fuse ftp fprintd foomatic-db-compressed-ppds "^fonts-tlwg.*" "^fonts-smc.*" "^fonts-noto.*" "^fonts-telu.*" "^fonts-taml.*" "^fonts-lohit.*" "^fonts-samyak.*" fonts-tibetan-machine fonts-pagul "^fonts-sil.*" fonts-lao fonts-opensymbol "^fonts-kacst.*" fonts-lklug-sinhala fakeroot file evince eog ed eject dosfstools dnsmasq-base dmz-cursor-theme dm-setup dirmngr cups-client cups-common cups-pk-helper cron cpio console-setup busybox-static bolt bluez-obexd bc bind9-host bind9-libs app-install-data-partner anacron acpid

# Add base kernel after removing HWE kernel
sudo apt -y install linux-generic

# Remove dependencies
sudo apt -y --purge autoremove

# Upgrade the system
sudo apt -y upgrade

# Remove temp files
sudo apt clean
rm -rf /home/user/*
rm -rf /home/user/.*
sudo rm -rf /root/*
sudo rm -rf /root/.*
sudo rm -rf /tmp/*
sudo rm -rf /var/log/*
sudo rm -rf /var/cache/*
sudo rm -rf /var/lib/apt/lists

# Remove old boot images
sudo rm /boot/*.old

# Zero free space    
dd bs=4M if=/dev/zero of=/var/tmp/empty; rm /var/tmp/empty

# Shut down
sudo shutdown now
